<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - DriveSafe</title>
    <link rel="stylesheet" href="../../assets/css/themes.css">
    <link rel="stylesheet" href="../../assets/css/style.css">
    <link rel="stylesheet" href="../../assets/css/responsive.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="dashboard-body">
    <!-- Header -->
    <header class="dashboard-header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-car-side"></i>
                    <span>DriveSafe</span>
                </div>
                
                <div class="header-actions">
                    <button class="notification-btn" onclick="toggleNotifications()">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge" id="notificationCount">3</span>
                    </button>
                    
                    <div class="user-menu">
                        <button class="user-btn" onclick="toggleUserMenu()">
                            <div class="user-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <span class="user-name" id="userName">Semon Neupane</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        
                        <div class="user-dropdown" id="userDropdown">
                            <a href="profile.html"><i class="fas fa-user"></i> Profile</a>
                            <a href="history.html"><i class="fas fa-history"></i> Service History</a>
                            <a href="#"><i class="fas fa-cog"></i> Settings</a>
                            <div class="dropdown-divider"></div>
                            <a href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Notification Panel -->
    <div class="notification-panel" id="notificationPanel">
        <div class="notification-header">
            <h3>Notifications</h3>
            <button class="close-notifications" onclick="toggleNotifications()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="notification-list">
            <div class="notification-item unread">
                <div class="notification-icon success">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="notification-content">
                    <h4>Service Completed</h4>
                    <p>Your battery jumpstart service has been completed successfully.</p>
                    <span class="notification-time">2 minutes ago</span>
                </div>
            </div>
            <div class="notification-item">
                <div class="notification-icon info">
                    <i class="fas fa-info-circle"></i>
                </div>
                <div class="notification-content">
                    <h4>Agent on the way</h4>
                    <p>Ram Bahadur is heading to your location. ETA: 12 minutes</p>
                    <span class="notification-time">15 minutes ago</span>
                </div>
            </div>
            <div class="notification-item">
                <div class="notification-icon warning">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="notification-content">
                    <h4>Payment Reminder</h4>
                    <p>Please complete payment for your last service request.</p>
                    <span class="notification-time">1 hour ago</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="dashboard-main">
        <div class="container">
            <!-- Welcome Section -->
            <section class="welcome-section">
                <div class="welcome-card">
                    <div class="welcome-content">
                        <h1>Welcome back, <span class="user-name">Semon!</span></h1>
                        <p>Ready to get roadside assistance whenever you need it?</p>
                        
                        <!-- Emergency Button -->
                        <div class="emergency-action">
                            <button class="btn-emergency" onclick="window.location.href='request-service.html?emergency=true'">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span>Emergency Help</span>
                            </button>
                            <p class="emergency-text">Tap for immediate assistance</p>
                        </div>
                    </div>
                    
                    <div class="welcome-stats">
                        <div class="stat-item">
                            <div class="stat-icon">
                                <i class="fas fa-wrench"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-number">12</span>
                                <span class="stat-label">Services Used</span>
                            </div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="stat-info">
                                <span class="stat-number">8 min</span>
                                <span class="stat-label">Avg Response</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Quick Services -->
            <section class="quick-services">
                <div class="section-header">
                    <h2>Quick Service Request</h2>
                    <p>Select the service you need right now</p>
                </div>
                
                <div class="services-grid">
                    <div class="service-card" onclick="requestService('battery')">
                        <div class="service-icon battery">
                            <i class="fas fa-battery-half"></i>
                        </div>
                        <h3>Battery Jumpstart</h3>
                        <p>Dead battery? Get a quick jumpstart</p>
                        <span class="service-price">From NPR 500</span>
                    </div>
                    
                    <div class="service-card" onclick="requestService('towing')">
                        <div class="service-icon towing">
                            <i class="fas fa-truck"></i>
                        </div>
                        <h3>Towing Service</h3>
                        <p>Vehicle breakdown? We'll tow it safely</p>
                        <span class="service-price">From NPR 1,500</span>
                    </div>
                    
                    <div class="service-card" onclick="requestService('puncture')">
                        <div class="service-icon puncture">
                            <i class="fas fa-circle"></i>
                        </div>
                        <h3>Tire Repair</h3>
                        <p>Flat tire or puncture repair</p>
                        <span class="service-price">From NPR 300</span>
                    </div>
                    
                    <div class="service-card" onclick="requestService('mechanic')">
                        <div class="service-icon mechanic">
                            <i class="fas fa-wrench"></i>
                        </div>
                        <h3>Minor Repairs</h3>
                        <p>Quick fixes and mechanical help</p>
                        <span class="service-price">From NPR 800</span>
                    </div>
                    
                    <div class="service-card" onclick="requestService('fuel')">
                        <div class="service-icon fuel">
                            <i class="fas fa-gas-pump"></i>
                        </div>
                        <h3>Fuel Assistance</h3>
                        <p>Out of fuel? We'll guide you to nearest station</p>
                        <span class="service-price">From NPR 200</span>
                    </div>
                    
                    <div class="service-card" onclick="requestService('ev')">
                        <div class="service-icon ev">
                            <i class="fas fa-bolt"></i>
                        </div>
                        <h3>EV Support</h3>
                        <p>Electric vehicle charging assistance</p>
                        <span class="service-price">From NPR 400</span>
                    </div>
                </div>
            </section>

            <!-- Current Service Status -->
            <section class="current-service" id="currentServiceSection" style="display: none;">
                <div class="section-header">
                    <h2>Current Service Request</h2>
                </div>
                
                <div class="service-status-card">
                    <div class="status-header">
                        <div class="service-info">
                            <h3 id="currentServiceType">Battery Jumpstart</h3>
                            <span class="service-id">Request #RSA2025001</span>
                        </div>
                        <div class="status-badge accepted" id="serviceStatus">
                            <i class="fas fa-check-circle"></i>
                            <span>Accepted</span>
                        </div>
                    </div>
                    
                    <div class="agent-info">
                        <div class="agent-details">
                            <div class="agent-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="agent-data">
                                <h4>Ram Bahadur Thapa</h4>
                                <div class="agent-rating">
                                    <div class="stars">
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                    </div>
                                    <span>4.8 (124 reviews)</span>
                                </div>
                                <p class="agent-specialization">
                                    <i class="fas fa-tools"></i>
                                    Battery & Electrical Specialist
                                </p>
                            </div>
                        </div>
                        
                        <div class="agent-actions">
                            <button class="btn-call" onclick="callAgent()">
                                <i class="fas fa-phone"></i>
                            </button>
                            <button class="btn-message" onclick="messageAgent()">
                                <i class="fas fa-comment"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="service-progress">
                        <div class="progress-bar">
                            <div class="progress-step completed">
                                <div class="step-circle">
                                    <i class="fas fa-check"></i>
                                </div>
                                <span>Request Placed</span>
                            </div>
                            <div class="progress-step completed">
                                <div class="step-circle">
                                    <i class="fas fa-check"></i>
                                </div>
                                <span>Agent Assigned</span>
                            </div>
                            <div class="progress-step active">
                                <div class="step-circle">
                                    <i class="fas fa-car"></i>
                                </div>
                                <span>On the Way</span>
                            </div>
                            <div class="progress-step">
                                <div class="step-circle">
                                    <i class="fas fa-wrench"></i>
                                </div>
                                <span>Service in Progress</span>
                            </div>
                            <div class="progress-step">
                                <div class="step-circle">
                                    <i class="fas fa-check-circle"></i>
                                </div>
                                <span>Completed</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="service-eta">
                        <div class="eta-info">
                            <i class="fas fa-clock"></i>
                            <span>ETA: <strong>12 minutes</strong></span>
                        </div>
                        <button class="btn-track" onclick="window.location.href='track-service.html'">
                            <i class="fas fa-map-marker-alt"></i>
                            Track Location
                        </button>
                    </div>
                </div>
            </section>

            <!-- Recent Services -->
            <section class="recent-services">
                <div class="section-header">
                    <h2>Recent Services</h2>
                    <a href="history.html" class="view-all">View All <i class="fas fa-arrow-right"></i></a>
                </div>
                
                <div class="services-list">
                    <div class="service-history-item">
                        <div class="service-icon-small battery">
                            <i class="fas fa-battery-half"></i>
                        </div>
                        <div class="service-details">
                            <h4>Battery Jumpstart</h4>
                            <p>Completed by Ram Bahadur • Teku, Kathmandu</p>
                            <span class="service-date">Today, 2:30 PM</span>
                        </div>
                        <div class="service-cost">
                            <span class="amount">NPR 600</span>
                            <span class="status completed">Completed</span>
                        </div>
                    </div>
                    
                    <div class="service-history-item">
                        <div class="service-icon-small puncture">
                            <i class="fas fa-circle"></i>
                        </div>
                        <div class="service-details">
                            <h4>Tire Repair</h4>
                            <p>Completed by Krishna Shrestha • Ring Road, Kathmandu</p>
                            <span class="service-date">Yesterday, 4:15 PM</span>
                        </div>
                        <div class="service-cost">
                            <span class="amount">NPR 400</span>
                            <span class="status completed">Completed</span>
                        </div>
                    </div>
                    
                    <div class="service-history-item">
                        <div class="service-icon-small towing">
                            <i class="fas fa-truck"></i>
                        </div>
                        <div class="service-details">
                            <h4>Towing Service</h4>
                            <p>Completed by Bikash Maharjan • Balkhu, Kathmandu</p>
                            <span class="service-date">3 days ago</span>
                        </div>
                        <div class="service-cost">
                            <span class="amount">NPR 2,100</span>
                            <span class="status completed">Completed</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Tips and Recommendations -->
            <section class="tips-section">
                <div class="section-header">
                    <h2>Tips & Recommendations</h2>
                </div>
                
                <div class="tips-grid">
                    <div class="tip-card">
                        <div class="tip-icon">
                            <i class="fas fa-battery-three-quarters"></i>
                        </div>
                        <h3>Battery Maintenance</h3>
                        <p>Check your battery terminals monthly and clean if corroded. Replace every 3-4 years.</p>
                    </div>
                    
                    <div class="tip-card">
                        <div class="tip-icon">
                            <i class="fas fa-tachometer-alt"></i>
                        </div>
                        <h3>Tire Pressure</h3>
                        <p>Check tire pressure monthly. Proper pressure improves fuel efficiency and prevents blowouts.</p>
                    </div>
                    
                    <div class="tip-card">
                        <div class="tip-icon">
                            <i class="fas fa-oil-can"></i>
                        </div>
                        <h3>Regular Servicing</h3>
                        <p>Schedule regular vehicle maintenance to prevent unexpected breakdowns on the road.</p>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- Quick Action Floating Button -->
    <div class="fab-container">
        <button class="fab-main" onclick="toggleQuickActions()">
            <i class="fas fa-plus"></i>
        </button>
        <div class="fab-actions" id="quickActions">
            <button class="fab-action emergency" onclick="requestEmergencyService()" title="Emergency Help">
                <i class="fas fa-exclamation-triangle"></i>
            </button>
            <button class="fab-action" onclick="requestService('battery')" title="Battery Jumpstart">
                <i class="fas fa-battery-half"></i>
            </button>
            <button class="fab-action" onclick="requestService('towing')" title="Towing Service">
                <i class="fas fa-truck"></i>
            </button>
            <button class="fab-action" onclick="requestService('puncture')" title="Tire Repair">
                <i class="fas fa-circle"></i>
            </button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../../config/constants.js"></script>
    <script src="../../config/api-endpoints.js"></script>
    <script src="../../assets/js/utils.js"></script>
    <script src="../../assets/js/auth.js"></script>
    <script src="../../assets/js/main.js"></script>
    <script src="../../assets/js/notifications.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            initializeDashboard();
            checkActiveService();
        });

        function toggleNotifications() {
            const panel = document.getElementById('notificationPanel');
            panel.classList.toggle('active');
        }

        function toggleUserMenu() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('active');
        }

        function toggleQuickActions() {
            const actions = document.getElementById('quickActions');
            actions.classList.toggle('active');
        }

        function requestService(serviceType) {
            window.location.href = `request-service.html?service=${serviceType}`;
        }

        function requestEmergencyService() {
            window.location.href = 'request-service.html?emergency=true';
        }

        function checkActiveService() {
            // Check if user has any active service requests
            // This would typically come from an API call
            const hasActiveService = localStorage.getItem('activeService');
            
            if (hasActiveService) {
                document.getElementById('currentServiceSection').style.display = 'block';
            }
        }

        function callAgent() {
            // Implement calling functionality
            window.open('tel:+9779841234567', '_self');
        }

        function messageAgent() {
            // Implement messaging functionality
            showToast('Opening chat with agent...', 'info');
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(event) {
            const userMenu = document.getElementById('userDropdown');
            const notificationPanel = document.getElementById('notificationPanel');
            const quickActions = document.getElementById('quickActions');
            
            if (!event.target.closest('.user-menu')) {
                userMenu.classList.remove('active');
            }
            
            if (!event.target.closest('.notification-btn') && !event.target.closest('.notification-panel')) {
                notificationPanel.classList.remove('active');
            }
            
            if (!event.target.closest('.fab-container')) {
                quickActions.classList.remove('active');
            }
        });
    </script>
</body>
</html>